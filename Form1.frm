VERSION 5.00
Begin VB.Form Form1 
   BorderStyle     =   0  'None
   Caption         =   "Form1"
   ClientHeight    =   3525
   ClientLeft      =   5580
   ClientTop       =   8595
   ClientWidth     =   6015
   Icon            =   "Form1.frx":0000
   LinkTopic       =   "Form1"
   ScaleHeight     =   235
   ScaleMode       =   3  'Pixel
   ScaleWidth      =   401
   ShowInTaskbar   =   0   'False
   Begin VB.PictureBox picCell 
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      BackColor       =   &H00000000&
      BorderStyle     =   0  'None
      Height          =   1440
      Index           =   31
      Left            =   4800
      Picture         =   "Form1.frx":1CFA
      ScaleHeight     =   96
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   40
      TabIndex        =   33
      Top             =   9060
      Visible         =   0   'False
      Width           =   600
   End
   Begin VB.PictureBox picCell 
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      BackColor       =   &H00000000&
      BorderStyle     =   0  'None
      Height          =   1440
      Index           =   30
      Left            =   4140
      Picture         =   "Form1.frx":4A3C
      ScaleHeight     =   96
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   40
      TabIndex        =   32
      Top             =   9060
      Visible         =   0   'False
      Width           =   600
   End
   Begin VB.PictureBox picCell 
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      BackColor       =   &H00000000&
      BorderStyle     =   0  'None
      Height          =   1440
      Index           =   29
      Left            =   3480
      Picture         =   "Form1.frx":777E
      ScaleHeight     =   96
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   40
      TabIndex        =   31
      Top             =   9060
      Visible         =   0   'False
      Width           =   600
   End
   Begin VB.PictureBox picCell 
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      BackColor       =   &H00000000&
      BorderStyle     =   0  'None
      Height          =   1440
      Index           =   28
      Left            =   2820
      Picture         =   "Form1.frx":A4C0
      ScaleHeight     =   96
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   40
      TabIndex        =   30
      Top             =   9060
      Visible         =   0   'False
      Width           =   600
   End
   Begin VB.PictureBox picCell 
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      BackColor       =   &H00000000&
      BorderStyle     =   0  'None
      Height          =   1440
      Index           =   27
      Left            =   2160
      Picture         =   "Form1.frx":D202
      ScaleHeight     =   96
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   40
      TabIndex        =   29
      Top             =   9060
      Visible         =   0   'False
      Width           =   600
   End
   Begin VB.PictureBox picCell 
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      BackColor       =   &H00000000&
      BorderStyle     =   0  'None
      Height          =   1440
      Index           =   26
      Left            =   1500
      Picture         =   "Form1.frx":FF44
      ScaleHeight     =   96
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   40
      TabIndex        =   28
      Top             =   9060
      Visible         =   0   'False
      Width           =   600
   End
   Begin VB.PictureBox picCell 
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      BackColor       =   &H00000000&
      BorderStyle     =   0  'None
      Height          =   1440
      Index           =   25
      Left            =   840
      Picture         =   "Form1.frx":12C86
      ScaleHeight     =   96
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   40
      TabIndex        =   27
      Top             =   9060
      Visible         =   0   'False
      Width           =   600
   End
   Begin VB.PictureBox picCell 
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      BackColor       =   &H00000000&
      BorderStyle     =   0  'None
      Height          =   1440
      Index           =   24
      Left            =   180
      Picture         =   "Form1.frx":159C8
      ScaleHeight     =   96
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   40
      TabIndex        =   26
      Top             =   9060
      Visible         =   0   'False
      Width           =   600
   End
   Begin VB.PictureBox picCell 
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      BackColor       =   &H00000000&
      BorderStyle     =   0  'None
      Height          =   1440
      Index           =   23
      Left            =   4800
      Picture         =   "Form1.frx":1870A
      ScaleHeight     =   96
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   40
      TabIndex        =   25
      Top             =   7560
      Visible         =   0   'False
      Width           =   600
   End
   Begin VB.PictureBox picCell 
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      BackColor       =   &H00000000&
      BorderStyle     =   0  'None
      Height          =   1440
      Index           =   22
      Left            =   4140
      Picture         =   "Form1.frx":1B44C
      ScaleHeight     =   96
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   40
      TabIndex        =   24
      Top             =   7560
      Visible         =   0   'False
      Width           =   600
   End
   Begin VB.PictureBox picCell 
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      BackColor       =   &H00000000&
      BorderStyle     =   0  'None
      Height          =   1440
      Index           =   21
      Left            =   3480
      Picture         =   "Form1.frx":1E18E
      ScaleHeight     =   96
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   40
      TabIndex        =   23
      Top             =   7560
      Visible         =   0   'False
      Width           =   600
   End
   Begin VB.PictureBox picCell 
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      BackColor       =   &H00000000&
      BorderStyle     =   0  'None
      Height          =   1440
      Index           =   20
      Left            =   2820
      Picture         =   "Form1.frx":20ED0
      ScaleHeight     =   96
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   40
      TabIndex        =   22
      Top             =   7560
      Visible         =   0   'False
      Width           =   600
   End
   Begin VB.PictureBox picCell 
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      BackColor       =   &H00000000&
      BorderStyle     =   0  'None
      Height          =   1440
      Index           =   19
      Left            =   2160
      Picture         =   "Form1.frx":23C12
      ScaleHeight     =   96
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   40
      TabIndex        =   21
      Top             =   7560
      Visible         =   0   'False
      Width           =   600
   End
   Begin VB.PictureBox picCell 
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      BackColor       =   &H00000000&
      BorderStyle     =   0  'None
      Height          =   1440
      Index           =   18
      Left            =   1500
      Picture         =   "Form1.frx":26954
      ScaleHeight     =   96
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   40
      TabIndex        =   20
      Top             =   7560
      Visible         =   0   'False
      Width           =   600
   End
   Begin VB.PictureBox picCell 
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      BackColor       =   &H00000000&
      BorderStyle     =   0  'None
      Height          =   1440
      Index           =   17
      Left            =   840
      Picture         =   "Form1.frx":29696
      ScaleHeight     =   96
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   40
      TabIndex        =   19
      Top             =   7560
      Visible         =   0   'False
      Width           =   600
   End
   Begin VB.PictureBox picCell 
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      BackColor       =   &H00000000&
      BorderStyle     =   0  'None
      Height          =   1440
      Index           =   16
      Left            =   180
      Picture         =   "Form1.frx":2C3D8
      ScaleHeight     =   96
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   40
      TabIndex        =   18
      Top             =   7560
      Visible         =   0   'False
      Width           =   600
   End
   Begin VB.PictureBox picCell 
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      BackColor       =   &H00000000&
      BorderStyle     =   0  'None
      Height          =   1440
      Index           =   15
      Left            =   4800
      Picture         =   "Form1.frx":2F11A
      ScaleHeight     =   96
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   40
      TabIndex        =   17
      Top             =   6060
      Visible         =   0   'False
      Width           =   600
   End
   Begin VB.PictureBox picCell 
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      BackColor       =   &H00000000&
      BorderStyle     =   0  'None
      Height          =   1440
      Index           =   14
      Left            =   4140
      Picture         =   "Form1.frx":31E5C
      ScaleHeight     =   96
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   40
      TabIndex        =   16
      Top             =   6060
      Visible         =   0   'False
      Width           =   600
   End
   Begin VB.PictureBox picCell 
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      BackColor       =   &H00000000&
      BorderStyle     =   0  'None
      Height          =   1440
      Index           =   13
      Left            =   3480
      Picture         =   "Form1.frx":34B9E
      ScaleHeight     =   96
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   40
      TabIndex        =   15
      Top             =   6060
      Visible         =   0   'False
      Width           =   600
   End
   Begin VB.PictureBox picCell 
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      BackColor       =   &H00000000&
      BorderStyle     =   0  'None
      Height          =   1440
      Index           =   12
      Left            =   2820
      Picture         =   "Form1.frx":378E0
      ScaleHeight     =   96
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   40
      TabIndex        =   14
      Top             =   6060
      Visible         =   0   'False
      Width           =   600
   End
   Begin VB.PictureBox picCell 
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      BackColor       =   &H00000000&
      BorderStyle     =   0  'None
      Height          =   1440
      Index           =   11
      Left            =   2160
      Picture         =   "Form1.frx":3A622
      ScaleHeight     =   96
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   40
      TabIndex        =   13
      Top             =   6060
      Visible         =   0   'False
      Width           =   600
   End
   Begin VB.PictureBox picCell 
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      BackColor       =   &H00000000&
      BorderStyle     =   0  'None
      Height          =   1440
      Index           =   10
      Left            =   1500
      Picture         =   "Form1.frx":3D364
      ScaleHeight     =   96
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   40
      TabIndex        =   12
      Top             =   6060
      Visible         =   0   'False
      Width           =   600
   End
   Begin VB.PictureBox picCell 
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      BackColor       =   &H00000000&
      BorderStyle     =   0  'None
      Height          =   1440
      Index           =   9
      Left            =   840
      Picture         =   "Form1.frx":400A6
      ScaleHeight     =   96
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   40
      TabIndex        =   11
      Top             =   6060
      Visible         =   0   'False
      Width           =   600
   End
   Begin VB.PictureBox picCell 
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      BackColor       =   &H00000000&
      BorderStyle     =   0  'None
      Height          =   1440
      Index           =   8
      Left            =   180
      Picture         =   "Form1.frx":42DE8
      ScaleHeight     =   96
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   40
      TabIndex        =   10
      Top             =   6060
      Visible         =   0   'False
      Width           =   600
   End
   Begin VB.PictureBox picCell 
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      BackColor       =   &H00000000&
      BorderStyle     =   0  'None
      Height          =   1440
      Index           =   7
      Left            =   4800
      Picture         =   "Form1.frx":45B2A
      ScaleHeight     =   96
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   40
      TabIndex        =   9
      Top             =   4560
      Visible         =   0   'False
      Width           =   600
   End
   Begin VB.PictureBox picCell 
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      BackColor       =   &H00000000&
      BorderStyle     =   0  'None
      Height          =   1440
      Index           =   6
      Left            =   4140
      Picture         =   "Form1.frx":4886C
      ScaleHeight     =   96
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   40
      TabIndex        =   8
      Top             =   4560
      Visible         =   0   'False
      Width           =   600
   End
   Begin VB.PictureBox picCell 
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      BackColor       =   &H00000000&
      BorderStyle     =   0  'None
      Height          =   1440
      Index           =   5
      Left            =   3480
      Picture         =   "Form1.frx":4B5AE
      ScaleHeight     =   96
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   40
      TabIndex        =   7
      Top             =   4560
      Visible         =   0   'False
      Width           =   600
   End
   Begin VB.PictureBox picCell 
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      BackColor       =   &H00000000&
      BorderStyle     =   0  'None
      Height          =   1440
      Index           =   4
      Left            =   2820
      Picture         =   "Form1.frx":4E2F0
      ScaleHeight     =   96
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   40
      TabIndex        =   6
      Top             =   4560
      Visible         =   0   'False
      Width           =   600
   End
   Begin VB.PictureBox picCell 
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      BackColor       =   &H00000000&
      BorderStyle     =   0  'None
      Height          =   1440
      Index           =   3
      Left            =   2160
      Picture         =   "Form1.frx":51032
      ScaleHeight     =   96
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   40
      TabIndex        =   5
      Top             =   4560
      Visible         =   0   'False
      Width           =   600
   End
   Begin VB.PictureBox picCell 
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      BackColor       =   &H00000000&
      BorderStyle     =   0  'None
      Height          =   1440
      Index           =   2
      Left            =   1500
      Picture         =   "Form1.frx":53D74
      ScaleHeight     =   96
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   40
      TabIndex        =   4
      Top             =   4560
      Visible         =   0   'False
      Width           =   600
   End
   Begin VB.PictureBox picCell 
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      BackColor       =   &H00000000&
      BorderStyle     =   0  'None
      Height          =   1440
      Index           =   1
      Left            =   840
      Picture         =   "Form1.frx":56AB6
      ScaleHeight     =   96
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   40
      TabIndex        =   3
      Top             =   4560
      Visible         =   0   'False
      Width           =   600
   End
   Begin VB.Timer Timer1 
      Enabled         =   0   'False
      Interval        =   30
      Left            =   1680
      Top             =   1260
   End
   Begin VB.PictureBox picCell 
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      BackColor       =   &H00000000&
      BorderStyle     =   0  'None
      Height          =   1440
      Index           =   0
      Left            =   180
      Picture         =   "Form1.frx":597F8
      ScaleHeight     =   96
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   40
      TabIndex        =   2
      Top             =   4560
      Visible         =   0   'False
      Width           =   600
   End
   Begin VB.PictureBox picBuffer 
      AutoRedraw      =   -1  'True
      BackColor       =   &H00000000&
      BorderStyle     =   0  'None
      Height          =   675
      Left            =   840
      ScaleHeight     =   45
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   49
      TabIndex        =   1
      Top             =   0
      Visible         =   0   'False
      Width           =   735
   End
   Begin VB.PictureBox picBlank 
      AutoRedraw      =   -1  'True
      BackColor       =   &H00000000&
      BorderStyle     =   0  'None
      Height          =   675
      Left            =   0
      ScaleHeight     =   45
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   49
      TabIndex        =   0
      Top             =   0
      Visible         =   0   'False
      Width           =   735
   End
End
Attribute VB_Name = "Form1"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Option Explicit
Private Const AC_SRC_OVER As Long = &H0&
Private Const ULW_COLORKEY As Long = &H1&
Private Const ULW_ALPHA As Long = &H2&
Private Const ULW_OPAQUE As Long = &H4&
Private Const WS_EX_TOPMOST As Long = &H8&
Private Const WS_EX_TRANSPARENT  As Long = &H20&
Private Const WS_EX_TOOLWINDOW As Long = &H80&
Private Const WS_EX_LAYERED As Long = &H80000
Private Const WS_POPUP = &H80000000
Private Const WS_VISIBLE = &H10000000
Private Const SPI_GETSELECTIONFADE As Long = &H1014&
Private BufferWidth As Long
Private BufferHeight As Long
Private Declare Function SetWindowPos Lib "user32" (ByVal hwnd As Long, ByVal hWndInsertAfter As Long, ByVal x As Long, ByVal y As Long, ByVal cx As Long, ByVal cy As Long, ByVal wFlags As Long) As Long

Private Const SWP_NOMOVE = &H2, SWP_NOSIZE = &H1
Private Const HWND_TOPMOST = -1, HWND_NOTOPMOST = -2
Private SlowPC As Boolean
Private ApplyAlpha As Boolean
Private ScreenTop As Long
Private FPSCalc As Long
Private FPSDisp As String
Private LastTickCount As Long
Sub SetTopmostWindow(ByVal hwnd As Long, Optional topmost As Boolean = True)
    Const HWND_NOTOPMOST = -2
    Const HWND_TOPMOST = -1
    Const SWP_NOMOVE = &H2
    Const SWP_NOSIZE = &H1
    SetWindowPos hwnd, IIf(topmost, HWND_TOPMOST, HWND_NOTOPMOST), 0, 0, 0, 0, SWP_NOMOVE + SWP_NOSIZE
End Sub
Private Sub Form_MouseMove(Button As Integer, Shift As Integer, x As Single, y As Single)
        Static X0 As Integer, Y0 As Integer
    If (RunMode = RM_NORMAL) Then           ' Determine screen saver mode
        If ((X0 = 0) And (Y0 = 0)) Or _
           ((Abs(X0 - x) < 5) And (Abs(Y0 - y) < 5)) Then ' small mouse movement...
            X0 = x                          ' Save current x coordinate
            Y0 = y                          ' Save current y coordinate
            Exit Sub                        ' Exit
        End If
        Unload Me
        End ' Large mouse movement (terminate screensaver)
    End If
End Sub

Private Sub Form_Load()
    Me.BackColor = 0

    If Len(GetSetting("PastaDrop", "Settings", "Slow")) = 0 Then
        SlowPC = False
    Else
        If CInt(GetSetting("PastaDrop", "Settings", "Slow")) = vbChecked Then
            SlowPC = True
        Else
            SlowPC = False
        End If
    End If
    If Len(GetSetting("PastaDrop", "Settings", "Alpha")) = 0 Then
        SlowPC = False
    Else
        If CInt(GetSetting("PastaDrop", "Settings", "Alpha")) = vbChecked Then
            ApplyAlpha = True
        Else
            ApplyAlpha = False
        End If
    End If
    
    Randomize Timer
        
    SetTopmostWindow Me.hwnd
    
    If (RunMode = RM_NORMAL) Then ShowCursor 0
    
    InitDeskDC DeskDC, DeskBmp, DispRec
    BufferWidth = DispRec.Right - DispRec.Left
    BufferHeight = (DispRec.Bottom - DispRec.Top) \ IIf(SlowPC, 3, 1)

    ScreenTop = IIf(SlowPC, BufferHeight, 0)

    ResizePIC picBlank
    ResizePIC picBuffer

    'MsgBox DispRec.Right - DispRec.Left & "x" & DispRec.Bottom - DispRec.Top
    
    FPSCalc = 0
    FPSDisp = "FPS"
    LastTickCount = GetTickCount
    SetupChars
    
    SetTextColor picBuffer.hdc, RGB(51, 102, 51)
    
    Timer1.Enabled = True
End Sub
Sub SetupChars()
Dim l As Long
Dim MaxSpeed As Long
    
    If Len(GetSetting("PastaDrop", "Settings", "NumLogos")) = 0 Then
        NumChars = 50
    Else
        NumChars = CLng(GetSetting("PastaDrop", "Settings", "NumLogos"))
    End If
    
    ReDim MC(NumChars)
    MaxSpeed = 7
    For l = 0 To NumChars - 1
        With MC(l)
            .x = Int(Rnd * (BufferWidth - 40))
            .y = Int(Rnd * BufferHeight) * -1
            .Speed = Int(Rnd * (MaxSpeed - 1)) + 1
            .Alpha = (255 \ MaxSpeed) * .Speed
            .CurrentFrame = Int(Rnd * 20)
        End With
    Next
End Sub
Sub ApplyChar(iMg As Integer, x As Long, y As Long, Alpha As Long)
Dim BF As BLENDFUNCTION
Dim lBF As Long
    With BF
        .BlendOp = AC_SRC_OVER
        .BlendFlags = WS_EX_TRANSPARENT
        .SourceConstantAlpha = Alpha
        .AlphaFormat = 1
    End With
    RtlMoveMemory lBF, BF, 4
    GdiAlphaBlend picBuffer.hdc, x, y, 40, 96, picCell(iMg).hdc, 0, 0, 40, 96, lBF
End Sub
Sub ApplyBlend()
Dim Blend As BLENDFUNCTION
Dim BlendPtr As Long
    Blend.SourceConstantAlpha = 32
    CopyMemory BlendPtr, Blend, 4
    AlphaBlend picBuffer.hdc, 0, 0, BufferWidth, BufferHeight, picBlank.hdc, 0, 0, BufferWidth, BufferHeight, BlendPtr
End Sub
Sub ClearBuffer()
    BitBlt picBuffer.hdc, 0, 0, BufferWidth, BufferHeight, picBlank.hdc, 0, 0, vbSrcCopy
End Sub

Sub ResizePIC(picIN As Control)
    picIN.Move picIN.Left, picIN.Top, BufferWidth, BufferHeight
End Sub

Sub BufferToScreen()
    BitBlt Me.hdc, 0, ScreenTop, BufferWidth, BufferHeight, picBuffer.hdc, 0, 0, vbSrcCopy
End Sub

Private Sub Timer1_Timer()
    
    If ApplyAlpha Then
        ApplyBlend
    Else
        ClearBuffer
    End If
    
    
    DrawChars
    
    '============= reinstate this code to display FPS ==============
    'FPSCalc = FPSCalc + 1
    'TextOut picBuffer.hdc, 2, 2, FPSDisp, Len(FPSDisp)
    'If GetTickCount > LastTickCount + 1000 Then
    '    FPSDisp = CStr(FPSCalc)
    '    FPSCalc = 0
    '    LastTickCount = GetTickCount
    'End If
    '===============================================================
    
    BufferToScreen
    
End Sub

Private Sub Form_Unload(Cancel As Integer)
    Timer1.Enabled = False
    
    DelDeskDC DeskDC
    
    If (RunMode = RM_NORMAL) Then ShowCursor -1
    Screen.MousePointer = vbDefault

End Sub
Sub DrawChars()
Dim l As Long
    For l = 0 To NumChars - 1
        With MC(l)
            ApplyChar .CurrentFrame, .x, .y, .Alpha
            .CurrentFrame = .CurrentFrame + 1
            If .CurrentFrame >= 31 Then .CurrentFrame = 0
            .y = .y + .Speed
            If .y > BufferHeight Then
                .y = -97
                .x = Int(Rnd * (BufferWidth - 40))
            End If
        End With
    Next
End Sub
